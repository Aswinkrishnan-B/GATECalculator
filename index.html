<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TCS iON Virtual Calculator – Close Replica</title>
  <style>
    :root{
      --bg:#1b2936;           /* page bg */
      --shell:#2b3b4b;        /* calculator body */
      --display:#0b1016;      /* display bg */
      --display-txt:#c8f7ff;  /* display text */
      --key:#d7dde3;          /* normal key */
      --key-txt:#0d1b2a;      /* normal key text */
      --op:#ff8a3d;           /* arithmetic ops */
      --op-txt:#fff;          
      --fn:#4da3ff;           /* function keys */
      --fn-txt:#fff;          
      --warn:#e74c3c;         /* C key */
      --ok:#36c690;           /* = key */
      --edge:#0007;           /* subtle borders */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg);
      display:grid; place-items:center; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    }
    .calc{
      width:min(760px,94vw);
      background:var(--shell);
      color:#fff; border-radius:14px; box-shadow:0 10px 35px #0006, inset 0 0 0 1px var(--edge);
      padding:18px; display:grid; gap:12px;
    }
    .topbar{display:flex; align-items:center; gap:10px;}
    .brand{font-weight:700; letter-spacing:.4px; opacity:.9}
    .indicators{margin-left:auto; display:flex; gap:10px; align-items:center;}
    .badge{min-width:28px; text-align:center; padding:2px 8px; border-radius:999px; font-size:12px; background:#0f2233; border:1px solid #17354c;}
    .badge.mem{display:none}

    .display{
      background:var(--display); color:var(--display-txt);
      border-radius:10px; padding:14px 12px; text-align:right;
      font-variant-numeric:tabular-nums; box-shadow:inset 0 0 0 1px #0a1926;
    }
    .expr{opacity:.75; font-size:12px; min-height:16px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .value{font-size:28px; line-height:1.3; word-break:break-all}

    .grid{
      display:grid; gap:8px; grid-template-columns:repeat(10, 1fr);
    }
    button{
      appearance:none; border:0; border-radius:8px; padding:12px 8px; font-weight:600; font-size:14px;
      background:var(--key); color:var(--key-txt); cursor:pointer; box-shadow:inset 0 -2px 0 #00000014;
      user-select:none; -webkit-user-select:none;
    }
    button:active{transform:translateY(1px)}
    .fn{background:var(--fn); color:var(--fn-txt)}
    .op{background:var(--op); color:var(--op-txt)}
    .danger{background:var(--warn); color:#fff}
    .ok{background:var(--ok); color:#08251b; font-weight:800}
    .tall{grid-column: span 2}

    .toggle{
      display:flex; background:#142231; border-radius:999px; padding:2px; gap:2px; border:1px solid #183246; height:36px
    }
    .toggle button{background:transparent; color:#b7d8ff; flex:1; border-radius:999px; font-weight:700}
    .toggle button.active{background:#1f3a53; color:#fff}

    .key-sm{font-size:12px}
    .key-sub{font-size:11px; opacity:.9}
    .right{justify-self:end}
  </style>
</head>
<body>
  <div class="calc" role="application" aria-label="TCS iON like virtual scientific calculator">

    <div class="topbar">
      <div class="brand">SCIENTIFIC CALCULATOR</div>
      <div class="indicators">
        <div class="badge" id="angBadge">DEG</div>
        <div class="badge mem" id="memBadge">M</div>
      </div>
    </div>

    <div class="display" aria-live="polite">
      <div class="expr" id="expr">&nbsp;</div>
      <div class="value" id="screen">0</div>
    </div>

    <!-- Angle + Memory Row -->
    <div class="grid" id="keys">
      <div class="toggle" style="grid-column: span 3">
        <button id="degBtn" class="active" onclick="setAngle('DEG')">Deg</button>
        <button id="radBtn" onclick="setAngle('RAD')">Rad</button>
      </div>
      <button class="fn" data-op="mod">mod</button>
      <button class="fn" data-const="PI">π</button>
      <button class="fn" data-const="E">e</button>
      <button class="fn key-sm" data-mem="MC">MC</button>
      <button class="fn key-sm" data-mem="MR">MR</button>
      <button class="fn key-sm" data-mem="MS">MS</button>
      <button class="fn key-sm" data-mem="M+">M+</button>
      <button class="fn key-sm" data-mem="M-">M-</button>

      <!-- Row 2 -->
      <button class="fn" data-fn="sinh">sinh</button>
      <button class="fn" data-fn="cosh">cosh</button>
      <button class="fn" data-fn="tanh">tanh</button>
      <button class="fn key-sm" data-exp="EXP">Exp</button>
      <button class="fn" data-unary="sq">x²</button>
      <button class="fn" data-unary="cube">x³</button>
      <button class="fn" data-edit="back">←</button>
      <button class="danger" data-edit="clear">C</button>
      <button class="fn" data-edit="sign">+/−</button>
      <button class="fn" data-unary="sqrt">√</button>

      <!-- Row 3 -->
      <button class="fn key-sm" data-fn="asinh">sinh⁻¹</button>
      <button class="fn key-sm" data-fn="acosh">cosh⁻¹</button>
      <button class="fn key-sm" data-fn="atanh">tanh⁻¹</button>
      <button class="fn" data-unary="log2">log₂</button>
      <button class="fn" data-unary="ln">ln</button>
      <button class="fn" data-unary="log10">log</button>
      <button data-num="7">7</button>
      <button data-num="8">8</button>
      <button data-num="9">9</button>
      <button class="op" data-op="/">÷</button>

      <!-- Row 4 -->
      <button class="fn" data-unary="fact">n!</button>
      <button class="fn key-sm" data-op="nCr">nCr</button>
      <button class="fn key-sm" data-op="nPr">nPr</button>
      <button class="fn" data-op="pow">xʸ</button>
      <button class="fn" data-unary="ex">eˣ</button>
      <button class="fn" data-unary="tenx">10ˣ</button>
      <button data-num="4">4</button>
      <button data-num="5">5</button>
      <button data-num="6">6</button>
      <button class="op" data-op="*">×</button>

      <!-- Row 5 -->
      <button class="fn" data-trig="sin">sin</button>
      <button class="fn" data-trig="cos">cos</button>
      <button class="fn" data-trig="tan">tan</button>
      <button class="fn key-sm" data-op="yroot">y√x</button>
      <button class="fn" data-unary="cbrt">∛</button>
      <button class="fn" data-unary="abs">|x|</button>
      <button data-num="1">1</button>
      <button data-num="2">2</button>
      <button data-num="3">3</button>
      <button class="op" data-op="-">−</button>

      <!-- Row 6 -->
      <button class="fn" data-const="PI">π</button>
      <button class="fn" data-const="E">e</button>
      <button class="fn" data-unary="inv">1/x</button>
      <button class="fn" data-unary="percent">%</button>
      <button data-num="0">0</button>
      <button data-dot=".">.</button>
      <button class="ok tall" data-eq="=">=</button>
      <button class="op" data-op="+">+</button>
    </div>
  </div>

  <script>
  (function(){
    const screen = document.getElementById('screen');
    const exprEl = document.getElementById('expr');
    const memBadge = document.getElementById('memBadge');
    const angBadge = document.getElementById('angBadge');
    const degBtn = document.getElementById('degBtn');
    const radBtn = document.getElementById('radBtn');

    let angle = 'DEG';
    let memory = 0; // shown when non-zero
    let acc = null;            // accumulator for binary ops
    let pending = null;        // pending binary op key
    let entering = true;       // are we typing a fresh number?
    let cur = '0';             // current input string
    let expMode = null;        // {mantissa:number, sign:1|-1, expStr:""}

    function fmt(n){
      if(!isFinite(n)) return 'Error';
      // Display up to 12 significant digits, similar to TCS rounding behavior
      const abs = Math.abs(n);
      if(abs !== 0 && (abs < 1e-6 || abs >= 1e10)) return n.toExponential(10).replace(/\+?0*(?=\d)/,'');
      // fixed or precision depending on decimals
      const s = Number(n.toPrecision(12)).toString();
      return s;
    }
    function update(){
      screen.textContent = cur;
      memBadge.style.display = memory ? 'inline-block' : 'none';
      angBadge.textContent = angle;
    }
    function setDisplayFromNumber(n){ cur = fmt(n); update(); }

    window.setAngle = function(mode){
      angle = mode;
      degBtn.classList.toggle('active', mode==='DEG');
      radBtn.classList.toggle('active', mode!=='DEG');
      update();
    }

    function getValue(){
      // if in exp entry mode, resolve to number
      if(expMode){
        const exp = Number(expMode.sign * (expMode.expStr? Number(expMode.expStr):0));
        const num = expMode.mantissa * Math.pow(10, exp);
        expMode = null; exprEl.textContent = '';
        return num;
      }
      return Number(cur.replace(/\u2212/g,'-'));
    }

    function setValue(n){
      expMode = null; exprEl.textContent = '';
      setDisplayFromNumber(n);
      entering = true;
    }

    function inputDigit(d){
      if(expMode){
        expMode.expStr = (expMode.expStr||'') + d;
        exprEl.textContent = `${fmt(expMode.mantissa)}E${expMode.sign<0?'-':''}${expMode.expStr}`;
        return;
      }
      if(entering){
        if(cur==='0' && d==='0') return; // keep single leading 0
        if(cur==='0' && d!=='0'){ cur = d; }
        else { cur += d; }
      } else { cur = d; entering = true; }
      update();
    }

    function inputDot(){
      if(expMode){ inputDigit('0'); return; }
      if(!cur.includes('.')){ cur += (entering?'.':'0.'); entering = true; update(); }
    }

    function clearAll(){ acc=null; pending=null; entering=false; cur='0'; expMode=null; exprEl.textContent=''; update(); }
    function back(){ if(expMode){ return; } cur = (cur.length>1? cur.slice(0,-1):'0'); update(); }
    function sign(){ if(expMode){ expMode.sign*=-1; exprEl.textContent = `${fmt(expMode.mantissa)}E${expMode.sign<0?'-':''}${expMode.expStr||''}`; return; } cur = cur.startsWith('-')? cur.slice(1):('-'+cur); update(); }

    function toRad(x){ return angle==='DEG'? (x*Math.PI/180): x; }
    function fromRad(x){ return angle==='DEG'? (x*180/Math.PI): x; }

    function unary(kind){
      const x = getValue();
      let r = NaN;
      switch(kind){
        case 'sqrt': r = Math.sqrt(x); break;
        case 'cbrt': r = Math.cbrt(x); break;
        case 'abs' : r = Math.abs(x); break;
        case 'inv' : r = 1/x; break;
        case 'percent': r = x/100; break;
        case 'sq': r = x*x; break;
        case 'cube': r = x*x*x; break;
        case 'log10': r = Math.log10(x); break;
        case 'log2': r = Math.log2(x); break;
        case 'ln': r = Math.log(x); break;
        case 'ex': r = Math.exp(x); break;
        case 'tenx': r = Math.pow(10,x); break;
        case 'fact': r = factorial(x); break;
      }
      setValue(r);
    }

    function trig(kind){
      const x = getValue();
      let r = NaN;
      switch(kind){
        case 'sin': r = Math.sin(toRad(x)); break;
        case 'cos': r = Math.cos(toRad(x)); break;
        case 'tan': r = Math.tan(toRad(x)); break;
        case 'asin': r = fromRad(Math.asin(x)); break;
        case 'acos': r = fromRad(Math.acos(x)); break;
        case 'atan': r = fromRad(Math.atan(x)); break;
      }
      setValue(r);
    }

    function hyper(kind){
      const x = getValue();
      let r = NaN;
      switch(kind){
        case 'sinh': r = Math.sinh(x); break;
        case 'cosh': r = Math.cosh(x); break;
        case 'tanh': r = Math.tanh(x); break;
        case 'asinh': r = Math.asinh(x); break;
        case 'acosh': r = Math.acosh(x); break;
        case 'atanh': r = Math.atanh(x); break;
      }
      setValue(r);
    }

    function factorial(n){
      // Only integers >=0, cap to avoid Infinity
      if(!Number.isFinite(n) || n<0 || Math.floor(n) !== n || n>170) return NaN;
      let f = 1; for(let i=2;i<=n;i++) f*=i; return f;
    }

    function binPrep(op){
      const x = getValue();
      if(acc===null){ acc = x; }
      else if(pending){ acc = apply(pending, acc, x); }
      pending = op; entering = false; cur = fmt(acc); update();
    }

    function apply(op,a,b){
      switch(op){
        case '+': return a+b;
        case '-': return a-b;
        case '*': return a*b;
        case '/': return a/b;
        case 'mod': return a % b;
        case 'pow': return Math.pow(a,b);
        case 'yroot': return Math.pow(a, 1/b);
        case 'nCr': return comb(a,b);
        case 'nPr': return perm(a,b);
        default: return b;
      }
    }

    function comb(n,r){ n=Math.floor(n); r=Math.floor(r); if(n<0||r<0||r>n) return NaN; return factorial(n)/(factorial(r)*factorial(n-r)); }
    function perm(n,r){ n=Math.floor(n); r=Math.floor(r); if(n<0||r<0||r>n) return NaN; return factorial(n)/factorial(n-r); }

    function equals(){
      const x = getValue();
      if(pending){ const r = apply(pending, acc??0, x); acc = null; pending=null; setValue(r); }
      else { setValue(x); }
    }

    function memoryDo(kind){
      const x = getValue();
      switch(kind){
        case 'MC': memory = 0; break;
        case 'MR': setValue(memory||0); return;
        case 'MS': memory = x; break;
        case 'M+': memory = (memory||0) + x; break;
        case 'M-': memory = (memory||0) - x; break;
      }
      update();
    }

    function setConst(name){
      const v = name==='PI'? Math.PI : Math.E;
      setValue(v);
    }

    function startExp(){
      const mant = getValue();
      expMode = {mantissa: mant, sign: 1, expStr: ''};
      exprEl.textContent = `${fmt(mant)}E`;
      entering=false; update();
    }

    // Event delegation
    document.getElementById('keys').addEventListener('click', (e)=>{
      const b = e.target.closest('button'); if(!b) return;
      const d = b.dataset;
      if(d.num){ inputDigit(d.num); return; }
      if(d.dot){ inputDot(); return; }
      if(d.edit){ if(d.edit==='clear') clearAll(); else if(d.edit==='back') back(); else if(d.edit==='sign') sign(); return; }
      if(d.unary){ unary(d.unary); return; }
      if(d.trig){ trig(d.trig); return; }
      if(d.fn){ hyper(d.fn); return; }
      if(d.const){ setConst(d.const); return; }
      if(d.mem){ memoryDo(d.mem); return; }
      if(d.op){ binPrep(d.op); return; }
      if(d.eq){ equals(); return; }
      if(d.exp){ startExp(); return; }
    });

    // keyboard (optional, but TCS typically disables) – keep minimal
    window.addEventListener('keydown', (ev)=>{
      const k = ev.key;
      if(/^[0-9]$/.test(k)) inputDigit(k);
      else if(k==='.') inputDot();
      else if(k==='+') binPrep('+');
      else if(k==='-') binPrep('-');
      else if(k==='*') binPrep('*');
      else if(k==='/') binPrep('/');
      else if(k==='Enter' || k==='=') equals();
      else if(k==='Backspace') back();
      else if(k==='Escape') clearAll();
    });

    // init
    update();
  })();
  </script>
</body>
</html>
